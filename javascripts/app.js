function encode(e){var t=e,o=encodeURIComponent(t).replace(/'/g,"%27").replace(/"/g,"%22");return o}function decode(e){var t=e,o=decodeURIComponent(t.replace(/\+/g," "));return o}function prepareBackbonePushState(){Backbone.history&&Backbone.history._hasPushState&&$(document).delegate("a[href^='/']","click",function(e){var t=$(this).attr("href"),o=this.protocol+"//";t.slice(o.length)!==o&&(e.preventDefault(),Backbone.history.navigate(t,!0))})}!function(){"use strict";var e="undefined"!=typeof window?window:global;if("function"!=typeof e.require){var t={},o={},n=function(e,t){return{}.hasOwnProperty.call(e,t)},i=function(e,t){var o,n,i=[];o=/^\.\.?(\/|$)/.test(t)?[e,t].join("/").split("/"):t.split("/");for(var a=0,r=o.length;r>a;a++)n=o[a],".."===n?i.pop():"."!==n&&""!==n&&i.push(n);return i.join("/")},a=function(e){return e.split("/").slice(0,-1).join("/")},r=function(t){return function(o){var n=a(t),r=i(n,o);return e.require(r,t)}},s=function(e,t){var n={id:e,exports:{}};return o[e]=n,t(n.exports,r(e),n),n.exports},l=function(e,a){var r=i(e,".");if(null==a&&(a="/"),n(o,r))return o[r].exports;if(n(t,r))return s(r,t[r]);var l=i(r,"./index");if(n(o,l))return o[l].exports;if(n(t,l))return s(l,t[l]);throw new Error('Cannot find module "'+e+'" from "'+a+'"')},c=function(e,o){if("object"==typeof e)for(var i in e)n(e,i)&&(t[i]=e[i]);else t[e]=o},u=function(){var e=[];for(var o in t)n(t,o)&&e.push(o);return e};e.require=l,e.require.define=c,e.require.register=c,e.require.list=u,e.require.brunch=!0}}(),window.Diskupon={DealCategory:{All:-11,New:-22,Hot:-33,EndingSoon:-44,ByCategory:-55,Honeymoon:-66},API_HOST:"diskupon.apphb.com",requestUrl:function(e){return"/"===e.substring(0,1)?"//"+this.API_HOST+e:"//"+this.API_HOST+"/api/"+e}},function(e){e.App=new Marionette.Application;var t=e.App;t.regionManager=new Marionette.RegionManager,t.regionManager.addRegions({Header:"#dsk_header",RegionSelector:"#dsk_pick_region",TopMenu:"#dsk_topMenu",TopMenuInner:"#dsk_topMenu_Inner",TopMenuInnerMobile:"#dsk_topMenu_Inner_Mobile",Main:"#dsk_main",Affiliates:"#dsk_affiliates",Footer:"#dsk_footer"}),t.on("start",function(){Backbone.history&&(Backbone.history.start({pushState:!0}),prepareBackbonePushState())}),t.vent.on("submodule:start",function(e,o,n){for(var i=0;i<e.length;i++){var a=e[i];a!==o?t.module(a).stop():t.module(a).start(n)}});var o=t.regionManager.get("Header").el;$(document).on("click",o+" #dsk_searchDeals_submit",function(e){return $(o+" #dsk_searchDeals_form").submit(),e.preventDefault(),!1}),$(document).on("submit",o+" #dsk_searchDeals_form",function(e){var t=$(o+" #dsk_searchDeals_query").val().trim();if(t){var n=encode(t);window.location.href="/kupons/search/"+n}return e.preventDefault(),!1}),$(document).on("click",".dsk-topMenuInnerMobile li a",function(){var e=$(".dsk-navtoggle").hasClass("collapsed");e||$(".dsk-navtoggle").trigger("click")}),t.SelectedRegionId={get:function(){var e=t.Storage.getItem("ds_regionid");null===e&&(e="2");var o=parseInt(e,10);return o},set:function(e){t.Storage.setItem("ds_regionid",e.toString())}},t.Storage={};var n={setItem:function(e,t){localStorage.setItem(e,t)},getItem:function(e){return localStorage.getItem(e)}},i={setItem:function(){},getItem:function(){return""}};t.Storage="undefined"!=typeof localStorage?n:i}(window.Diskupon),function(e,t){var o=function(){return{showHeader:function(){t.Cart.controller.showCartLink(),t.RegionSelector.controller.show(),t.TopMenu.controller.show()},showAffiliates:function(){t.Affiliates.controller.show()},showHomePage:function(){this.showHeader(),this.showAffiliates(),t.Deals.controller.showTopDealsGroupByCategory()},showAllKuponsPage:function(){t.TopMenu.controller.listenTo(t.TopMenu.controller,"topmenu:shown",function(){t.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e.DealCategory.All)}),this.showHeader(),this.showAffiliates(),t.Deals.controller.showDealsList({categoryId:e.DealCategory.All,searchQuery:""})},showNewKuponsPage:function(){t.TopMenu.controller.listenTo(t.TopMenu.controller,"topmenu:shown",function(){t.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e.DealCategory.New)}),this.showHeader(),this.showAffiliates(),t.Deals.controller.showDealsList({categoryId:e.DealCategory.New,searchQuery:""})},showEndingSoonKuponsPage:function(){t.TopMenu.controller.listenTo(t.TopMenu.controller,"topmenu:shown",function(){t.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e.DealCategory.EndingSoon)}),this.showHeader(),this.showAffiliates(),t.Deals.controller.showDealsList(e.DealCategory.EndingSoon)},showHotKuponsPage:function(){t.TopMenu.controller.listenTo(t.TopMenu.controller,"topmenu:shown",function(){t.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e.DealCategory.Hot)}),this.showHeader(),this.showAffiliates(),t.Deals.controller.showDealsList({categoryId:e.DealCategory.Hot,searchQuery:""})},showKuponsByCategory:function(o){t.TopMenu.controller.listenTo(t.TopMenu.controller,"topmenu:shown",function(){t.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e.DealCategory.ByCategory,o)}),this.showHeader(),this.showAffiliates(),t.Deals.controller.showDealsList({categoryId:o,searchQuery:""})},showHoneymoon:function(){t.TopMenu.controller.listenTo(t.TopMenu.controller,"topmenu:shown",function(){t.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e.DealCategory.Honeymoon)}),this.showHeader(),this.showAffiliates()},showKuponDetails:function(e){this.showHeader(),this.showAffiliates(),t.Deals.controller.showDealDetails(e)},searchForKupons:function(o){t.TopMenu.controller.listenTo(t.TopMenu.controller,"topmenu:shown",function(){t.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e.DealCategory.All)}),this.showHeader(),this.showAffiliates(),t.Deals.controller.showDealsList({categoryId:e.DealCategory.All,searchQuery:o})}}}();e.AppRouter=Backbone.Marionette.AppRouter.extend({execute:function(){}}),t.addInitializer(function(){new e.AppRouter({controller:o,appRoutes:{"":"showHomePage","kupons/all":"showAllKuponsPage","kupons/new":"showNewKuponsPage","kupons/endingsoon":"showEndingSoonKuponsPage","kupons/hot":"showHotKuponsPage","kupons/category/:id/:name":"showKuponsByCategory","kupons/honeymoon":"showHoneymoon","kupons/details/:id/:name":"showKuponDetails","kupons/search/:query":"searchForKupons"}})})}(window.Diskupon,window.Diskupon.App),function(e){e.App.module("Cart",function(e,t,o,n,i){var a=o.Model.extend({idAttribute:"CartSummaryItemId",url:"/api/v1/cart",initialize:function(){"undefined"!=typeof o.Memento&&(this.memento=new o.Memento(this))},deleteData:function(e){var t=i.Deferred();return this.destroy({data:{CartSummaryItemId:this.id,KuponId:this.get("KuponId"),CartInfo:e},wait:!0,success:function(){t.resolve()},error:function(){t.reject()}}),t.promise()},saveDataChanges:function(e){var t=this,o=this.changedAttributes();o.CartInfo=e,this.save(o,{wait:!0,success:function(){},error:function(){t.memento.restore()}})},substractQty:function(e){this.memento.store();var t=parseInt(this.get("QtyBought"),10);if(0>=t)return!1;t--;var o=this.get("PricePerUnit"),n=Math.ceil(t*o);this.set({QtyBought:t,Price:n}),this.saveDataChanges(e)},addQty:function(e){this.memento.store();var t=parseInt(this.get("QtyBought"),10);t++;var o=this.get("PricePerUnit"),n=Math.ceil(t*o);this.set({QtyBought:t,Price:n}),this.saveDataChanges(e)}}),r=o.Collection.extend({model:a,url:"/api/v1/cart",getData:function(e){this.fetch({reset:!0,data:i.param(e)})},subTotal:function(){var e=0;return this.each(function(t){e+=parseInt(t.get("Price"),10)}),e},qtyTotal:function(){var e=0;return this.each(function(t){e+=parseInt(t.get("QtyBought"),10)}),e}});e.Repository=n.Controller.extend({initialize:function(){},getCartSummary:function(e){var t=i.Deferred(),o=new r;return o.on("reset",function(e){t.resolve(e)}),o.getData(e),t.promise()}})})}(window.Diskupon),function(e){e.App.module("Cart.CartLink",function(e,t,o,n,i,a){e.CartSummaryEmptyView=n.ItemView.extend({template:tpl_cart_summary_empty}),e.CartSummaryItemView=n.ItemView.extend({tagName:"li",className:"media dsk-csi",template:tpl_cart_summary_item,events:{"click .dsk-csi-addQty":"addQty","click .dsk-csi-substractQty":"substractQty","click .dsk-csi-del":"deleteSummaryCartItem"},initialize:function(){this.model.on("change",this.render,this)},addQty:function(e){e.preventDefault(),this.trigger("cartsummaryitem:qtyadded")},substractQty:function(e){e.preventDefault(),this.trigger("cartsummaryitem:qtysubstracted")},deleteSummaryCartItem:function(e){e.preventDefault(),this.trigger("cartsummaryitem:demanddelete")}}),e.CartSummaryView=n.CompositeView.extend({itemView:e.CartSummaryItemView,template:tpl_cart_summary,itemViewContainer:"#dsk_cartList",emptyView:e.CartSummaryEmptyView,onRender:function(){var e=this;this.on("itemview:cartsummaryitem:qtyadded",function(o){var n=t.Cart.controller.CartInfo;o.model.addQty(n),e.renderCartTotals()}),this.on("itemview:cartsummaryitem:qtysubstracted",function(o){var n=t.Cart.controller.CartInfo;o.model.substractQty(n),e.renderCartTotals()}),this.on("itemview:cartsummaryitem:demanddelete",function(o){var n=t.Cart.controller.CartInfo,i=o.model.deleteData(n);i.done(function(){o.close()}),i.always(function(){e.checkListStatus(),e.renderCartTotals()})}),this.checkListStatus(),this.renderCartTotals()},checkListStatus:function(){this.collection.length>0?this.trigger("cartsummary:notempty"):this.trigger("cartsummary:empty")},renderCartTotals:function(){var e=this.collection.qtyTotal()+" items, subtotal: "+accounting.formatNumber(this.collection.subTotal(),0);this.$el.find(".dsk-cartTotals p span").html(e)}}),e.CartLinkView=n.ItemView.extend({template:tpl_cart_link,events:{"click #dsk_showCartSummary":"showCartSummaryModal"},initialize:function(){a.bindAll(this,"showCartSummaryModal"),this.csView=null,this.csRegion=null},_closeCartSummaryView:function(){this.csView&&this.csView.close()},_showLoader:function(){this.$el.find("#cartSummaryModal .loader").show()},_hideLoader:function(){this.$el.find("#cartSummaryModal .loader").hide()},_showError:function(){this.$el.find("#cartSummaryModal .error-cart").show()},_hideError:function(){this.$el.find("#cartSummaryModal .error-cart").hide()},_showCartSummaryView:function(t){var n=this,i=t;this._hideError();var a=o.Marionette.Region.extend({el:this.$el.find("#cartSummaryModal #dsk_cartSummaryContainer")}),r=new e.CartSummaryView({collection:i});r.on("cartsummary:notempty",function(){n.$el.find("#dsk_checkoutButton").prop("disabled",!1),n.$el.find("#dsk_gotocartButton").prop("disabled",!1)}),r.on("cartsummary:empty",function(){n.$el.find("#dsk_checkoutButton").prop("disabled",!0),n.$el.find("#dsk_gotocartButton").prop("disabled",!0)}),this.csView=r,this.csRegion=new a,this.csRegion.show(this.csView)},onRender:function(){var e=this,t=this.$el.find("#cartSummaryModal");t.modal({show:!1}),t.on("show.bs.modal",function(){e._closeCartSummaryView(),e._showLoader()}),t.on("shown.bs.modal",function(){e.trigger("cartsummary:shown")})},showCartSummaryModal:function(e){e.preventDefault();var t=this.$el.find("#cartSummaryModal");t.modal("show")}}),e.Controller=n.Controller.extend({initialize:function(e){a.bindAll(this,"show"),this.ContainerRegion=e.ContainerRegion},show:function(){var o=this,n=new e.CartLinkView({el:i("#dsk_cartLinkSection")});this.listenTo(n,"cartsummary:shown",function(){var e=t.Cart.controller.CartInfo,i=o.getCartSummary(e);i.done(function(e){n._showCartSummaryView(e)}),i.fail(function(){n._showError()}),i.always(function(){n._hideLoader()})}),this.ContainerRegion.attachView(n),this.ContainerRegion.show(n)},getCartSummary:function(e){var o=new t.Cart.Repository,n=i.Deferred(),a=o.getCartSummary(e);return a.done(function(e){n.resolve(e)}),a.fail(function(){n.reject()}),n.promise()}}),e.addInitializer(function(){e.controller=new e.Controller({ContainerRegion:t.regionManager.get("Header")})})})}(window.Diskupon),function(e){e.App.module("Cart",function(e,t,o,n){var i={CartId:"-1",Token:"ThisSupposeToBeRandomToken2014ForTheCart2014",Timestamp:"1395215527756",UserId:"-1"};e.Controller=n.Controller.extend({initialize:function(){this.initCartInfo()},initCartInfo:function(){var e,o=t.Storage.getItem("ds_cartInfo");if(o&&o.length>0)e=JSON.parse(o);else{e=i;var n=JSON.stringify(e);t.Storage.setItem("ds_cartInfo",n)}this.CartInfo=e},showCartLink:function(){e.CartLink.controller.show()}}),e.addInitializer(function(){e.controller=new e.Controller({})}),e.addFinalizer(function(){e.controller.close(),delete e.controller})})}(window.Diskupon),function(e){e.App.module("Affiliates",function(e,t,o,n,i,a){e.AffiliatesView=n.ItemView.extend({template:tpl_affiliates,tagName:"div",className:"",events:{},onRender:function(){this.$el.find("#affiliates_stream").flexslider({animation:"slide",controlNav:!1,animationLoop:!0,slideshow:!0,itemWidth:150,pauseOnAction:!1,pauseOnHover:!1,pausePlay:!1,slideshowSpeed:6e3})}}),e.Controller=n.Controller.extend({initialize:function(e){a.bindAll(this,"show"),this.AffiliatesRegion=e.AffiliatesRegion},show:function(){var t=new e.AffiliatesView({});this.AffiliatesRegion.show(t)}}),e.addInitializer(function(){e.controller=new e.Controller({AffiliatesRegion:t.regionManager.get("Affiliates")})})})}(window.Diskupon),function(e){e.App.module("HomeSlides",function(e,t,o,n,i,a){this.startWithParent=!1,e.on("start",function(){}),e.HomeSlidesView=n.ItemView.extend({template:tpl_home_slides,tagName:"div",className:"",events:{},onRender:function(){}}),e.Controller=n.Controller.extend({initialize:function(e){a.bindAll(this,"show"),this.HomeSlidesRegion=e.HomeSlidesRegion},show:function(){var t=new e.HomeSlidesView({});this.HomeSlidesRegion.show(t)}}),e.addInitializer(function(t){e.controller=new e.Controller({HomeSlidesRegion:t.HomeSlidesRegion})})})}(window.Diskupon),function(e){e.App.module("RegionSelector",function(e,t,o,n,i,a){e.SelectRegionView=n.ItemView.extend({template:tpl_region_selector,tagName:"span",className:"dsk-regionPicker",events:{"change #dsk_select_region":"regionChanged"},onRender:function(){this.$el.find("#dsk_select_region").val(t.SelectedRegionId.get())},regionChanged:function(e){e.preventDefault();var t=parseInt(i(e.currentTarget).val(),10);this.trigger("region:changed",t)}}),e.Controller=n.Controller.extend({initialize:function(e){a.bindAll(this,"show","_regionChanged"),this.RegionSelectorRegion=e.RegionSelectorRegion},show:function(){var o=this,n=new t.Deals.Repository,i=n.getRegions();i.done(function(t){var n=new e.SelectRegionView({collection:t});o.listenTo(n,"region:changed",o._regionChanged),o.RegionSelectorRegion.show(n)})},_regionChanged:function(e){this.trigger("region:changed",e)}}),e.addInitializer(function(){e.controller=new e.Controller({RegionSelectorRegion:t.regionManager.get("RegionSelector")}),e.controller.listenTo(e.controller,"region:changed",function(e){t.SelectedRegionId.set(e),window.location.href="/"})})})}(window.Diskupon),function(e){e.App.module("TopMenu",function(e,t,o,n,i,a){e.TopMenuItemView=n.ItemView.extend({tagName:"li",template:tpl_top_menu,onBeforeRender:function(){var e=this.model.get("SubCategories");e&&e.length>0?(this.$el.addClass("dropdown"),this.model.set("HasSubCategories",!0)):this.model.set("HasSubCategories",!1);var t=parseInt(this.model.get("CategoryId"),10);this.$el.attr("data-key",t)}}),e.TopMenuCollectionView=n.CollectionView.extend({tagName:"ul",className:"nav nav-pills dsk-topMenuInner",itemView:e.TopMenuItemView,initialize:function(e){a.bindAll(this,"setActiveMenuItem"),this.activeTopMenuKey=e.activeTopMenuKey,this.activeTopMenuSubKey=e.activeTopMenuSubKey},onRender:function(){},setActiveMenuItem:function(e){this.$el.find(".active").removeClass("active"),e&&this.$el.find('[data-key="'+e+'"]').addClass("active")}}),e.TopMenuMobileItemView=n.ItemView.extend({tagName:"li",template:tpl_top_menu_mobile,onBeforeRender:function(){var e=this.model.get("SubCategories");e&&e.length>0?(this.$el.addClass("dropdown"),this.model.set("HasSubCategories",!0)):this.model.set("HasSubCategories",!1);var t=parseInt(this.model.get("CategoryId"),10);this.$el.attr("data-key",t)}}),e.TopMenuMobileCollectionView=n.CollectionView.extend({tagName:"ul",className:"nav nav-pills dsk-topMenuInnerMobile",itemView:e.TopMenuMobileItemView,initialize:function(e){a.bindAll(this,"setActiveMenuItem"),this.activeTopMenuKey=e.activeTopMenuKey,this.activeTopMenuSubKey=e.activeTopMenuSubKey},onRender:function(){},setActiveMenuItem:function(e,t){this.$el.find(".active").removeClass("active");var o=0;t?o=t:e&&(o=e),o&&this.$el.find('[data-key="'+o+'"]').addClass("active")}}),e.Controller=n.Controller.extend({initialize:function(e){a.bindAll(this,"show","setActiveMenuItem"),this.TopMenuRegion=e.TopMenuRegion,this.TopMenuRegionMobile=e.TopMenuRegionMobile,this.TopMenuView=void 0,this.TopMenuMobileView=void 0},show:function(){var o=this,n=new t.Deals.Repository,i=n.getDealCategories();i.done(function(t){var n=new e.TopMenuCollectionView({collection:t});o.TopMenuView=n,o.TopMenuRegion.show(n);var i=new e.TopMenuMobileCollectionView({collection:t});o.TopMenuMobileView=i,o.TopMenuRegionMobile.show(i),o.trigger("topmenu:shown")}),i.fail(function(){}),i.always(function(){})},setActiveMenuItem:function(e,t){this.TopMenuView.setActiveMenuItem(e,t),this.TopMenuMobileView.setActiveMenuItem(e,t)}}),e.addInitializer(function(){e.controller=new e.Controller({TopMenuRegion:t.regionManager.get("TopMenuInner"),TopMenuRegionMobile:t.regionManager.get("TopMenuInnerMobile")}),e.controller.listenTo(e.controller,"topmenu:changeactivemenuitem",function(t,o){e.controller.setActiveMenuItem(t,o)})})})}(window.Diskupon),function(e){e.App.module("Deals",function(t,o,n,i,a,r){t.DealModel=n.Model.extend({initialize:function(){},url:e.requestUrl("deals"),getDeal:function(e){this.fetch({data:a.param(e)})}}),t.DealCollection=n.Collection.extend({model:t.DealModel,url:e.requestUrl("deals"),search:function(e){this.fetch({reset:!0,data:a.param(e)})}}),t.DealCategoryModel=n.Model.extend({initialize:function(){}}),t.DealCategoryCollection=n.Collection.extend({model:t.DealCategoryModel,url:e.requestUrl("dealcategories")}),t.RegionModel=n.Model.extend({initialize:function(){}}),t.RegionCollection=n.Collection.extend({model:t.RegionModel,url:e.requestUrl("regions")}),t.Repository=i.Controller.extend({initialize:function(){r.bindAll(this,"search"),this.defaultSearchParams={RegionId:1,CategoryId:1,PageSize:65e3,PageNumber:1,SearchQuery:""}},search:function(e){var o=a.extend({},this.defaultSearchParams,e),n=a.Deferred(),i=new t.DealCollection;return i.on("reset",function(e){n.resolve(e)}),i.search(o),n.promise()},getOne:function(e){var o=new t.DealModel,n=a.Deferred();return o.on("change",function(e){n.resolve(e)}),o.getDeal({DealId:e}),n.promise()},getDealCategories:function(){var e=a.Deferred(),o=new t.DealCategoryCollection;return o.on("reset",function(t){e.resolve(t)}),o.fetch({reset:!0}),e.promise()},getRegions:function(){var e=a.Deferred(),o=new t.RegionCollection;return o.on("reset",function(t){e.resolve(t)}),o.fetch({reset:!0}),e.promise()}})})}(window.Diskupon),function(e){function t(){u=$("#map-canvas").parent().width(),$("#map-canvas").css("width","100%"),$("#map-canvas").css("height","400px")}function o(e,o,n){s=e,l=o,c=n,t(),i=new google.maps.Geocoder;var u=new google.maps.LatLng(s,l),h={zoom:16,center:u};a=new google.maps.Map(document.getElementById("map-canvas"),h),google.maps.event.addListenerOnce(a,"idle",function(){setTimeout(function(){d.open(a,r)},500)})}function n(){var e=new google.maps.LatLng(s,l);i.geocode({latLng:e},function(t,o){o==google.maps.GeocoderStatus.OK?t[1]?(r=new google.maps.Marker({position:e,map:a}),d.setOptions({maxWidth:u/2}),d.setContent(c)):console.log("No results found"):console.log("Geocoder failed due to: "+o)})}if("undefined"==typeof google)return e.init=function(){},e.draw=function(){},!1;var i,a,r,s,l,c,u,d=new google.maps.InfoWindow;e.init=o,e.draw=n}(window.Diskupon.gmapsapi=window.Diskupon.gmapsapi||{}),function(e){e.App.module("Deals.Details",function(t,o,n,i,a,r){this.startWithParent=!1,t.on("start",function(){}),t.DealsDetailsView=i.ItemView.extend({template:tpl_deal_details,tagName:"div",className:"dsk-dealDetails",onRender:function(){var e=this;this.$el.find("#deal_images_navs").flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,itemWidth:100,asNavFor:"#deal_images"}),this.$el.find("#deal_images").flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,sync:"#deal_images_navs"}),this.$el.find(".sliderMain-imgContainer").imgLiquid(),this.$el.find("#map-canvas").show("fast",function(){var t=e.model.get("PrimaryKupon");if(t.KuponLocation){var o="<h4>"+t.KuponLocation.LocationName+"</h4>                                   <p>"+t.KuponLocation.LocationAddress+"</p>                                  ";window.Diskupon.gmapsapi.init(t.KuponLocation.Latitude,t.KuponLocation.Longitude,o),window.Diskupon.gmapsapi.draw()}})}}),t.Controller=i.Controller.extend({initialize:function(e){r.bindAll(this,"showDealsDetails","renderDealsDetails"),this.DealsDetailsRegion=e.DealsDetailsRegion,this.DealsDetailsMobileRegion=e.DealsDetailsMobileRegion,this.DealId=0},renderDealsDetails:function(e){var o=new t.DealsDetailsView({model:e});this.DealsDetailsRegion.show(o),this.trigger("dealdetails:detailsshown",e.toJSON())},showDealsDetails:function(){var e=this,t=new o.Deals.Repository,n=t.getOne(this.DealId);n.done(function(t){e.renderDealsDetails(t)})}}),t.addInitializer(function(n){t.controller=new t.Controller({DealsDetailsRegion:n.DealsDetailsRegion,DealsDetailsMobileRegion:n.DealsDetailsMobileRegion}),t.controller.listenTo(t.controller,"dealdetails:detailsshown",function(t){o.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e.DealCategory.ByCategory,t.DealCategoryId)})}),t.addFinalizer(function(){t.controller.close(),delete t.controller})})}(window.Diskupon),function(e){e.App.module("Deals.List",function(t,o,n,i,a,r){this.startWithParent=!1,t.on("start",function(){}),t.DealsListItemView=i.ItemView.extend({template:tpl_deals_item,tagName:"div",className:"dsk-dealContainer pull-left"}),t.DealsListCollectionView=i.CollectionView.extend({tagName:"div",className:"dsk-listOfDeals clearfix",itemView:t.DealsListItemView,onRender:function(){this.$el.find(".dsk-di-cover").lazyload({}),this.$el.find(".dsk-dealItem").hover(function(){a(this).addClass("hover")},function(){a(this).removeClass("hover")})}}),t.DealsListMobileItemView=i.ItemView.extend({template:tpl_deals_item_mobile,tagName:"div",className:"dsk-dealContainer-mobile clearfix"}),t.DealsListMobileCollectionView=i.CollectionView.extend({tagName:"div",className:"dsk-listOfDeals-mobile clearfix",itemView:t.DealsListMobileItemView,onRender:function(){this.$el.find(".dsk-di-cover-mobile").lazyload({})}}),t.Controller=i.Controller.extend({initialize:function(t){r.bindAll(this,"showDeals","renderDeals"),this.DealsListRegion=t.DealsListRegion,this.DealsListMobileRegion=t.DealsListMobileRegion,this.SearchParams={RegionId:1,CategoryId:e.DealCategory.All,PageNumber:1,SearchQuery:""}},renderDeals:function(e){if(a(this.DealsListRegion.el).is(":visible")){var o=new t.DealsListCollectionView({collection:e});this.DealsListRegion.show(o),this.trigger("dealslist:listshown")}if(a(this.DealsListMobileRegion.el).is(":visible")){var n=new t.DealsListMobileCollectionView({collection:e});this.DealsListMobileRegion.show(n),this.trigger("dealslist:listmobileshown")}},showDeals:function(){var e=this,t=new o.Deals.Repository;this.SearchParams.RegionId=o.SelectedRegionId.get();var n=t.search(this.SearchParams);n.done(function(t){e.renderDeals(t)})}}),t.addInitializer(function(e){t.controller=new t.Controller({DealsListRegion:e.DealsListRegion,DealsListMobileRegion:e.DealsListMobileRegion}),t.controller.listenTo(t.controller,"dealslist:listshown",function(){a(window).trigger("scroll")}),t.controller.listenTo(t.controller,"dealslist:listmobileshown",function(){a(window).trigger("scroll")})}),t.addFinalizer(function(){t.controller.close(),delete t.controller})})}(window.Diskupon),function(e){e.App.module("Deals",function(t,o,n,i,a,r){var s=n.Marionette.Layout.extend({template:"#dealListPageLayout_template",regions:{HomeSlides:"#dsk_homeSlides",MainContent:"#dsk_content",MainContentMobile:"#dsk_content_mobile"},className:"container"}),l=n.Marionette.Layout.extend({template:"#dealDetailsPageLayout_template",regions:{MainContent:"#dsk_content",MainContentMobile:"#dsk_content_mobile"},className:"container"}),c=["Deals.List","Deals.Details"];t.on("start",function(){t.listLayout=new s,t.detailsLayout=new l}),t.Controller=i.Controller.extend({initialize:function(){r.bindAll(this,"showDealsList","showDealDetails")},_renderListLayout:function(){t.listLayout.render(),o.regionManager.get("Main").show(t.listLayout)},_renderDetailsLayout:function(){t.detailsLayout.render(),o.regionManager.get("Main").show(t.detailsLayout)},_startListSubmodule:function(){var e={DealsListRegion:t.listLayout.MainContent,DealsListMobileRegion:t.listLayout.MainContentMobile};o.vent.trigger("submodule:start",c,"Deals.List",e)},_startDetailsModule:function(){var e={DealsDetailsRegion:t.detailsLayout.MainContent,DealsDetailsMobileRegion:t.detailsLayout.MainContentMobile};o.vent.trigger("submodule:start",c,"Deals.Details",e)},_startHomeSlidesModule:function(){var e={HomeSlidesRegion:t.listLayout.HomeSlides};o.module("HomeSlides").start(e)},showDealsList:function(t){var n={categoryId:e.DealCategory.All,searchQuery:""};t=a.extend({},n,t),this._renderListLayout(),this._startHomeSlidesModule(),this._startListSubmodule(),o.Deals.List.controller.SearchParams.CategoryId=t.categoryId,o.Deals.List.controller.SearchParams.SearchQuery=t.searchQuery,o.Deals.List.controller.showDeals(),o.HomeSlides.controller.show()},showDealDetails:function(e){this._renderDetailsLayout(),this._startDetailsModule(),o.Deals.Details.controller.DealId=e,o.Deals.Details.controller.showDealsDetails()},showTopDealsGroupByCategory:function(){this._renderListLayout(),this._startHomeSlidesModule(),o.HomeSlides.controller.show()}}),t.addInitializer(function(){t.controller=new t.Controller({})}),t.addFinalizer(function(){t.controller.close(),delete t.controller})})}(window.Diskupon),function(e){e(document).ajaxStart(function(){NProgress&&NProgress.start()}),e(document).ajaxStop(function(){NProgress&&NProgress.done(!0)})}(jQuery),window.onerror=function(e){console.log(e),NProgress&&NProgress.done(!0)};
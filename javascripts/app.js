!function(){"use strict";var e="undefined"!=typeof window?window:global;if("function"!=typeof e.require){var t={},o={},n=function(e,t){return{}.hasOwnProperty.call(e,t)},i=function(e,t){var o,n,i=[];o=/^\.\.?(\/|$)/.test(t)?[e,t].join("/").split("/"):t.split("/");for(var a=0,l=o.length;l>a;a++)n=o[a],".."===n?i.pop():"."!==n&&""!==n&&i.push(n);return i.join("/")},a=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t){return function(o){var n=a(t),l=i(n,o);return e.require(l,t)}},s=function(e,t){var n={id:e,exports:{}};return o[e]=n,t(n.exports,l(e),n),n.exports},r=function(e,a){var l=i(e,".");if(null==a&&(a="/"),n(o,l))return o[l].exports;if(n(t,l))return s(l,t[l]);var r=i(l,"./index");if(n(o,r))return o[r].exports;if(n(t,r))return s(r,t[r]);throw new Error('Cannot find module "'+e+'" from "'+a+'"')},c=function(e,o){if("object"==typeof e)for(var i in e)n(e,i)&&(t[i]=e[i]);else t[e]=o},u=function(){var e=[];for(var o in t)n(t,o)&&e.push(o);return e};e.require=r,e.require.define=c,e.require.register=c,e.require.list=u,e.require.brunch=!0}}(),window.Diskupon={DealCategory:{All:-11,New:-22,Hot:-33,EndingSoon:-44,ByCategory:-55,Honeymoon:-66},API_HOST:"diskupon.apphb.com",requestUrl:function(e){return"/"===e.substring(0,1)?"//"+this.API_HOST+e:"//"+this.API_HOST+"/api/"+e}},function(e){e.App=new Marionette.Application;var t=e.App;t.regionManager=new Marionette.RegionManager,t.regionManager.addRegions({Header:"#dsk_header",RegionSelector:"#dsk_pick_region",TopMenu:"#dsk_topMenu",TopMenuInner:"#dsk_topMenu_Inner",TopMenuInnerMobile:"#dsk_topMenu_Inner_Mobile",Main:"#dsk_main",Footer:"#dsk_footer"}),t.on("start",function(){Backbone.history&&(Backbone.history.start({pushState:!0}),others.prepareBackbonePushState())}),t.HomePageLayout=Backbone.Marionette.Layout.extend({template:"#homePageLayout_template",regions:{HomeSlides:"#dsk_homeSlides",MainContent:"#dsk_content",MainContentMobile:"#dsk_content_mobile"},className:"container"}),t.DetailsPageLayout=Backbone.Marionette.Layout.extend({template:"#detailsPageLayout1_template",regions:{MainContent:"#dsk_content",MainContentMobile:"#dsk_content_mobile"},className:"container"}),t.vent.on("submodule:start",function(e,o,n){for(var i=0;i<e.length;i++){var a=e[i];a!==o?t.module(a).stop():t.module(a).start(n)}}),t.SelectedRegionId={get:function(){var e=localStorage.getItem("ds_regionid");null===e&&(e="2");var t=parseInt(e,10);return t},set:function(e){localStorage.setItem("ds_regionid",e.toString())}}}(window.Diskupon),function(e,t){var o={showOthers:function(e,o){t.RegionSelector.controller.show(),t.TopMenu.controller.listenTo(t.TopMenu.controller,"topmenu:shown",function(){t.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e,o)}),t.TopMenu.controller.show()},showHomePage:function(){this.showOthers(e.DealCategory.All),t.Deals.controller.showDealsList(e.DealCategory.All)},showAllKuponsPage:function(){this.showOthers(e.DealCategory.All),t.Deals.controller.showDealsList(e.DealCategory.All)},showNewKuponsPage:function(){this.showOthers(e.DealCategory.New),t.Deals.controller.showDealsList(e.DealCategory.New)},showEndingSoonKuponsPage:function(){this.showOthers(e.DealCategory.EndingSoon),t.Deals.controller.showDealsList(e.DealCategory.EndingSoon)},showHotKuponsPage:function(){this.showOthers(e.DealCategory.Hot),t.Deals.controller.showDealsList(e.DealCategory.Hot)},showKuponsByCategory:function(o){this.showOthers(e.DealCategory.ByCategory,o),t.Deals.controller.showDealsList(e.DealCategory.ByCategory,o)},showHoneymoon:function(){this.showOthers(e.DealCategory.Honeymoon)},showKuponDetails:function(e){this.showOthers(),t.Deals.controller.showDealDetails(e)}};e.AppRouter=Backbone.Marionette.AppRouter.extend({}),t.addInitializer(function(){new e.AppRouter({controller:o,appRoutes:{"":"showHomePage","kupons/all":"showAllKuponsPage","kupons/new":"showNewKuponsPage","kupons/endingsoon":"showEndingSoonKuponsPage","kupons/hot":"showHotKuponsPage","kupons/:id/:name":"showKuponsByCategory","kupons/honeymoon":"showHoneymoon","kupons/details/:id/:name":"showKuponDetails"}})})}(window.Diskupon,window.Diskupon.App),function(e){e.App.module("Deals",function(t,o,n,i,a,l){t.DealModel=n.Model.extend({initialize:function(){},url:e.requestUrl("deals"),get:function(e){this.fetch({data:a.param(e)})}}),t.DealCollection=n.Collection.extend({model:t.DealModel,url:e.requestUrl("deals"),search:function(e){this.fetch({reset:!0,data:a.param(e)})}}),t.DealCategoryModel=n.Model.extend({initialize:function(){}}),t.DealCategoryCollection=n.Collection.extend({model:t.DealCategoryModel,url:e.requestUrl("dealcategories")}),t.RegionModel=n.Model.extend({initialize:function(){}}),t.RegionCollection=n.Collection.extend({model:t.RegionModel,url:e.requestUrl("regions")}),t.Repository=i.Controller.extend({initialize:function(){l.bindAll(this,"search"),this.defaultSearchParams={RegionId:1,CategoryId:1,PageSize:65e3,PageNumber:1}},search:function(e){var o=a.extend(this.defaultSearchParams,e),n=a.Deferred(),i=new t.DealCollection;return i.on("reset",function(e){n.resolve(e)}),i.search(o),n.promise()},getOne:function(e){var o=new t.DealModel,n=a.Deferred();return o.on("change",function(e){n.resolve(e)}),o.get({DealId:e}),n.promise()},getDealCategories:function(){var e=a.Deferred(),o=new t.DealCategoryCollection;return o.on("reset",function(t){e.resolve(t)}),o.fetch({reset:!0}),e.promise()},getRegions:function(){var e=a.Deferred(),o=new t.RegionCollection;return o.on("reset",function(t){e.resolve(t)}),o.fetch({reset:!0}),e.promise()}})})}(window.Diskupon),function(e){e.App.module("Deals.Details",function(t,o,n,i,a,l){this.startWithParent=!1,t.on("start",function(){}),t.DealsDetailsView=i.ItemView.extend({template:tpl_deal_details,tagName:"div",className:"dsk-dealDetails",onRender:function(){this.$el.find("#deal_images_navs").flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,itemWidth:100,asNavFor:"#deal_images"}),this.$el.find("#deal_images").flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,sync:"#deal_images_navs"}),this.$el.find("#dsk_dd_tabs a:first").tab("show"),this.$el.find(".sliderMain-imgContainer").imgLiquid()}}),t.Controller=i.Controller.extend({initialize:function(e){this.DealsDetailsRegion=e.DealsDetailsRegion,this.DealsDetailsMobileRegion=e.DealsDetailsMobileRegion,this.DealId=0,l.bindAll(this,"showDealsDetails","renderDealsDetails")},renderDealsDetails:function(e){var o=new t.DealsDetailsView({model:e});this.DealsDetailsRegion.show(o),this.trigger("dealdetails:detailsshown",e.toJSON())},showDealsDetails:function(){var e=this,t=new o.Deals.Repository,n=t.getOne(this.DealId);n.done(function(t){e.renderDealsDetails(t)})}}),t.addInitializer(function(n){t.controller=new t.Controller({DealsDetailsRegion:n.DealsDetailsRegion,DealsDetailsMobileRegion:n.DealsDetailsMobileRegion}),t.controller.listenTo(t.controller,"dealdetails:detailsshown",function(t){console.log(t.DealCategoryId),o.TopMenu.controller.trigger("topmenu:changeactivemenuitem",e.DealCategory.ByCategory,t.DealCategoryId)})}),t.addFinalizer(function(){t.controller.close(),delete t.controller})})}(window.Diskupon),function(e){e.App.module("Deals.List",function(t,o,n,i,a,l){this.startWithParent=!1,t.on("start",function(){}),t.DealsListItemView=i.ItemView.extend({template:tpl_deals_item,tagName:"div",className:"dsk-dealContainer pull-left"}),t.DealsListCollectionView=i.CollectionView.extend({tagName:"div",className:"dsk-listOfDeals clearfix",itemView:t.DealsListItemView,onRender:function(){this.$el.find(".dsk-di-cover").lazyload({}),this.$el.find(".dsk-dealItem").hover(function(){a(this).addClass("hover")},function(){a(this).removeClass("hover")})}}),t.DealsListMobileItemView=i.ItemView.extend({template:tpl_deals_item_mobile,tagName:"div",className:"dsk-dealContainer-mobile media"}),t.DealsListMobileCollectionView=i.CollectionView.extend({tagName:"div",className:"dsk-listOfDeals-mobile clearfix media-list",itemView:t.DealsListMobileItemView,onRender:function(){this.$el.find(".dsk-di-cover-mobile").lazyload({})}}),t.Controller=i.Controller.extend({initialize:function(t){this.DealsListRegion=t.DealsListRegion,this.DealsListMobileRegion=t.DealsListMobileRegion,this.SearchParams={RegionId:1,CategoryId:e.DealCategory.All,PageNumber:1},l.bindAll(this,"showDeals","renderDeals")},renderDeals:function(e){if(a(this.DealsListRegion.el).is(":visible")){var o=new t.DealsListCollectionView({collection:e});this.DealsListRegion.show(o)}if(a(this.DealsListMobileRegion.el).is(":visible")){var n=new t.DealsListMobileCollectionView({collection:e});this.DealsListMobileRegion.show(n)}},showDeals:function(){var e=this,t=new o.Deals.Repository;this.SearchParams.RegionId=o.SelectedRegionId.get();var n=t.search(this.SearchParams);n.done(function(t){e.renderDeals(t)})}}),t.addInitializer(function(e){t.controller=new t.Controller({DealsListRegion:e.DealsListRegion,DealsListMobileRegion:e.DealsListMobileRegion})}),t.addFinalizer(function(){t.controller.close(),delete t.controller})})}(window.Diskupon),function(e){e.App.module("Deals",function(t,o,n,i){var a=["Deals.List","Deals.Details"];t.on("start",function(){t.listLayout=new o.HomePageLayout,t.detailsLayout=new o.DetailsPageLayout}),t.Controller=i.Controller.extend({initialize:function(){},_startListSubmodule:function(){t.listLayout.render(),o.regionManager.get("Main").show(t.listLayout);var e={DealsListRegion:t.listLayout.MainContent,DealsListMobileRegion:t.listLayout.MainContentMobile};o.vent.trigger("submodule:start",a,"Deals.List",e)},_startDetailsModule:function(){t.detailsLayout.render(),o.regionManager.get("Main").show(t.detailsLayout);var e={DealsDetailsRegion:t.detailsLayout.MainContent,DealsDetailsMobileRegion:t.detailsLayout.MainContentMobile};o.vent.trigger("submodule:start",a,"Deals.Details",e)},showDealsList:function(t,n){switch(this._startListSubmodule(),t){case e.DealCategory.All:o.Deals.List.controller.SearchParams.CategoryId=e.DealCategory.All;break;case e.DealCategory.New:o.Deals.List.controller.SearchParams.CategoryId=e.DealCategory.New;break;case e.DealCategory.Hot:o.Deals.List.controller.SearchParams.CategoryId=e.DealCategory.Hot;break;case e.DealCategory.EndingSoon:o.Deals.List.controller.SearchParams.CategoryId=e.DealCategory.EndingSoon;break;case e.DealCategory.ByCategory:o.Deals.List.controller.SearchParams.CategoryId=n;break;default:o.Deals.List.controller.SearchParams.CategoryId=e.DealCategory.All}o.Deals.List.controller.showDeals()},showDealDetails:function(e){this._startDetailsModule(),o.Deals.Details.controller.DealId=e,o.Deals.Details.controller.showDealsDetails()}}),t.addInitializer(function(){t.controller=new t.Controller({})}),t.addFinalizer(function(){t.controller.close(),delete t.controller})})}(window.Diskupon),Backbone.ajax=function(){var e=Array.prototype.slice.call(arguments);return e[0]&&(e[0].type="POST"),Backbone.$.ajax.apply(Backbone.$,e)};var others={prepareBackbonePushState:function(){Backbone.history&&Backbone.history._hasPushState&&$(document).delegate("a[href^='/']","click",function(e){var t=$(this).attr("href"),o=this.protocol+"//";t.slice(o.length)!==o&&(e.preventDefault(),Backbone.history.navigate(t,!0))})}};!function(e){e.App.module("RegionSelector",function(e,t,o,n,i,a){e.SelectRegionView=n.ItemView.extend({template:tpl_region_selector,tagName:"span",className:"dsk-regionPicker",events:{"change #dsk_select_region":"regionChanged"},onRender:function(){this.$el.find("#dsk_select_region").val(t.SelectedRegionId.get())},regionChanged:function(e){e.preventDefault();var t=parseInt(i(e.currentTarget).val(),10);this.trigger("region:changed",t)}}),e.Controller=n.Controller.extend({initialize:function(e){a.bindAll(this,"show","_regionChanged"),this.RegionSelectorRegion=e.RegionSelectorRegion},show:function(){var o=this,n=new t.Deals.Repository,i=n.getRegions();i.done(function(t){var n=new e.SelectRegionView({collection:t});o.listenTo(n,"region:changed",o._regionChanged),o.RegionSelectorRegion.show(n)})},_regionChanged:function(e){this.trigger("region:changed",e)}}),e.addInitializer(function(){e.controller=new e.Controller({RegionSelectorRegion:t.regionManager.get("RegionSelector")}),e.controller.listenTo(e.controller,"region:changed",function(e){t.SelectedRegionId.set(e),window.location.href="/"})})})}(window.Diskupon),function(e){e.App.module("TopMenu",function(e,t,o,n,i,a){e.TopMenuItemView=n.ItemView.extend({tagName:"li",template:tpl_top_menu,onBeforeRender:function(){var e=this.model.get("SubCategories");e&&e.length>0?(this.$el.addClass("dropdown"),this.model.set("HasSubCategories",!0)):this.model.set("HasSubCategories",!1);var t=parseInt(this.model.get("CategoryId"),10);this.$el.attr("data-key",t)}}),e.TopMenuCollectionView=n.CollectionView.extend({tagName:"ul",className:"nav nav-pills dsk-topMenuInner",itemView:e.TopMenuItemView,initialize:function(e){a.bindAll(this,"setActiveMenuItem"),this.activeTopMenuKey=e.activeTopMenuKey,this.activeTopMenuSubKey=e.activeTopMenuSubKey},onRender:function(){},setActiveMenuItem:function(e){this.$el.find(".active").removeClass("active"),e&&this.$el.find('[data-key="'+e+'"]').addClass("active")}}),e.TopMenuMobileItemView=n.ItemView.extend({tagName:"li",template:tpl_top_menu_mobile,onBeforeRender:function(){var e=this.model.get("SubCategories");e&&e.length>0?(this.$el.addClass("dropdown"),this.model.set("HasSubCategories",!0)):this.model.set("HasSubCategories",!1);var t=parseInt(this.model.get("CategoryId"),10);this.$el.attr("data-key",t)}}),e.TopMenuMobileCollectionView=n.CollectionView.extend({tagName:"ul",className:"nav nav-pills dsk-topMenuInnerMobile",itemView:e.TopMenuMobileItemView,initialize:function(e){a.bindAll(this,"setActiveMenuItem"),this.activeTopMenuKey=e.activeTopMenuKey,this.activeTopMenuSubKey=e.activeTopMenuSubKey},onRender:function(){},setActiveMenuItem:function(e,t){this.$el.find(".active").removeClass("active");var o=0;t?o=t:e&&(o=e),o&&this.$el.find('[data-key="'+o+'"]').addClass("active")}}),e.Controller=n.Controller.extend({initialize:function(e){a.bindAll(this,"show","setActiveMenuItem"),this.TopMenuRegion=e.TopMenuRegion,this.TopMenuRegionMobile=e.TopMenuRegionMobile,this.TopMenuView=void 0,this.TopMenuMobileView=void 0},show:function(){var o=this,n=new t.Deals.Repository,i=n.getDealCategories();i.done(function(t){var n=new e.TopMenuCollectionView({collection:t});o.TopMenuView=n,o.TopMenuRegion.show(n);var i=new e.TopMenuMobileCollectionView({collection:t});o.TopMenuMobileView=i,o.TopMenuRegionMobile.show(i),o.trigger("topmenu:shown")}),i.fail(function(){}),i.always(function(){})},setActiveMenuItem:function(e,t){this.TopMenuView.setActiveMenuItem(e,t),this.TopMenuMobileView.setActiveMenuItem(e,t)}}),e.addInitializer(function(){e.controller=new e.Controller({TopMenuRegion:t.regionManager.get("TopMenuInner"),TopMenuRegionMobile:t.regionManager.get("TopMenuInnerMobile")}),e.controller.listenTo(e.controller,"topmenu:changeactivemenuitem",function(t,o){e.controller.setActiveMenuItem(t,o)})})})}(window.Diskupon);